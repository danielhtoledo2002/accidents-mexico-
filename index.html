<!DOCTYPE html>
<html lang="en">
<!--Zona de Scripts y de Estilo de la pagina "nada visual" -->
<head>
    <link href="styles.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <meta charset="utf-8">
    <style>
    @import url('https://fonts.googleapis.com/css?family=Karla:400,700&display=swap');
    .font-family-karla { font-family: karla; }
    .bg-sidebar { background: #3d68ff; }
    .cta-btn { color: #3d68ff; }
    .upgrade-btn { background: #1947ee; }
    .upgrade-btn:hover { background: #0038fd; }
    .active-nav-link { background: #1947ee; }
    .nav-item:hover { background: #1947ee; }
    .account-link:hover { background: #3d68ff; }
    </style>
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/8/89/INEGI.png" />
    <title>Análisis Accidentes</title>
    <script>
        async function getQuery(anio) {
            let chartStatus = Chart.getChart("myChart");
            if (chartStatus != undefined) {
                chartStatus.destroy();
            }

            let response = await fetch(`/query1/${anio}`, {mode: 'cors'});



            const ctx = document.getElementById('myChart');

            let json = await response.json()

            let labels =  json.x
            let values =  json.y

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Número de accidentes por estado ${anio}`,
                        data: values,
                        borderWidth: 1,
                        backgroundColor: 'rgba(61,104,255,0.5 )',
                        borderColor:'#fff'


                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            ticks: { color: 'black', beginAtZero: true }
                        },
                        x: {
                            ticks: { color: 'black', beginAtZero: true }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'black',

                                font: {
                                    size: 20,
                                    weight: '1000'
                                }
                            }
                        },
                    }
                }
            });
        }
    </script>


    <script>
      async function getQuery2(anio2) {
          let chartStatus = Chart.getChart("myChart2");
          if (chartStatus != undefined) {
              chartStatus.destroy();
          }

          let response = await fetch(`/query2/${anio2}`, {mode: 'cors'});

          const ctx = document.getElementById('myChart2');

          let json = await response.json()

          let labels =  json.x
          let values =  json.y

          new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: labels,
                  datasets: [{
                      label: `Número de accidentes de borrachos por estado ${anio2}`,
                      data: values,
                      borderWidth: 0.5,
                      backgroundColor: "rgba(61,104,255,0.5 )",
                      borderColor:'#fff'
                  }]
              },
              options: {
                  responsive: true,
                  scales: {
                      y: {
                          ticks: { color: 'black', beginAtZero: true }
                      },
                      x: {
                          ticks: { color: 'black', beginAtZero: true }
                      }
                  },
                  plugins: {
                      legend: {
                          labels: {
                              color: 'black',

                              font: {
                                  size: 20,
                                  weight: '1000'
                              }
                          }
                      },

                  }
              }
          });
      }
    </script>

    <script>
      async function getQuery3(){
        let chartStatus = Chart.getChart("myChart3");
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }

        let response = await fetch(`/query3/`, {mode: 'cors'});

        const ctx = document.getElementById('myChart3');

        let json = await response.json()

        let labels =  json.x
        let values =  json.y

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: `Número de Accidentes por Año `,
                    data: values,
                    borderWidth:5,
                    backgroundColor: "rgba(61,104,255,0.5 )",
                    borderColor:'white'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        ticks: { color: 'black', beginAtZero: true }
                    },
                    x: {
                        ticks: { color: 'black', beginAtZero: true }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'black',

                            font: {
                                size: 20,
                                weight: '1000'
                            }
                        }
                    },
                },

            }
        });

    }
    </script>

    <script>
      async function getQuery4(){
          let chartStatus = Chart.getChart("myChart4");
          if (chartStatus != undefined) {
              chartStatus.destroy();
          }

          let response = await fetch(`/query4/`, {mode: 'cors'});

          const ctx = document.getElementById('myChart4');

          let json = await response.json()

          let labels =  json.x
          let values =  json.y

          new Chart(ctx, {
              type: 'pie',
              data: {
                  labels: labels,
                  datasets: [{
                      label: `Número  `,
                      data: values,
                      borderWidth: 2,
                      backgroundColor: ["rgba(61,104,255,0.5 )","rgba(18,31,76,0.5 )"],
                      borderColor:"#fff"
                  }]
              },
              options: {
                  responsive: true,

                  scales: {
                      y: {
                          ticks: { color: 'black', beginAtZero: true }
                      },
                      x: {
                          ticks: { color: 'black', beginAtZero: true }
                      }
                  },
                  plugins: {

                      legend: {
                          labels: {
                              color: 'black',
                              title: {
                                  display: true,
                                  text: 'Número de accidentes por zona',
                              },
                              font: {
                                  size: 20,
                                  weight: '100'
                              }
                          }
                      },


                  }
              }
          });

      }
    </script>

    <script>
    async function getQuery5(){
        let chartStatus = Chart.getChart("myChart5");
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }

        let response = await fetch(`/query5/`, {mode: 'cors'});

        const ctx = document.getElementById('myChart5');

        let json = await response.json()

        let labels =  json.x
        let values =  json.y



        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: `Tabla de accidentes en las horas `,
                    data: values,
                    borderWidth: 0.5,
                    backgroundColor: "rgba(61,104,255,0.5)",
                    borderColor:'#fff'
                }]
            },
            options: {
                responsive: true,

                scales: {
                    y: {
                        ticks: { color: 'black', beginAtZero: true }
                    },
                    x: {
                        ticks: { color: 'black', beginAtZero: true }
                    }
                },
                plugins: {


                    legend: {
                        labels: {
                            color: 'black',
                            title: {
                                display: true,
                                text: 'Número de accidentes por zona',
                                padding: {
                                    top: 100,
                                    bottom: 30
                                }
                            },
                            font: {
                                size: 20,
                                weight: '1000'
                            }
                        }
                    },


                }
            }
        });
    }
    </script>

    <script>
     async function getQuery6(){
         let chartStatus = Chart.getChart("myChart6");
         if (chartStatus != undefined) {
             chartStatus.destroy();
         }

         let response = await fetch(`/query6/`, {mode: 'cors'});

         const ctx = document.getElementById('myChart6');

         let json = await response.json()


         let labels =  json.x
         let values =  json.y

         new Chart(ctx, {
             type: 'bar',
             data: {
                 labels: labels,
                 datasets: [{
                     label: `Tabla total tipos de accidentes`,
                     data: values,
                     borderWidth: 0.5,
                     backgroundColor: "rgba(61,104,255,0.5 )",
                     borderColor:'#fff'
                 }]
             },
             options: {
                 responsive: true,

                 scales: {
                     y: {
                         ticks: { color: 'black', beginAtZero: true }
                     },
                     x: {
                         ticks: { color: 'black', beginAtZero: true }
                     }
                 },
                 plugins: {


                     legend: {
                         labels: {
                             color: 'black',
                             title: {
                                 display: true,
                                 text: 'Número de accidentes por zona',
                                 padding: {
                                     top: 100,
                                     bottom: 30
                                 }
                             },
                             font: {
                                 size: 10,
                                 weight: '1000'
                             }
                         }
                     },


                 }
             }
         });
     }
    </script>
    <!--Grafica de Radar de dia -->
    <script>
    async function getQuery7(){
        let chartStatus = Chart.getChart("myChart7");
        if (chartStatus != undefined) {
            chartStatus.destroy();
        }

        let response = await fetch(`/query7/`, {mode: 'cors'});

        const ctx = document.getElementById('myChart7');

        let json = await response.json()

        let labels =  json.x
        let hours =  json.y
        let values = json.z
        let Lunes = values.slice(0, 24);
        let martes = values.slice(24, 48);
        let miercoles = values.slice(48, 72);
        let jueves = values.slice(72, 96);
        let viernes = values.slice(96, 120);
        let sabado = values.slice(120, 144);
        let domingo = values.slice(144, 168);




        function onlyUnique(value, index, array) {
            return array.indexOf(value) === index;
        }
        let hours_f  = hours.filter(onlyUnique)
        let labels_f =  labels.filter(onlyUnique)
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],
                datasets: [{
                    label: labels_f[0],
                    data: Lunes,
                    borderWidth: 0.5,
                    backgroundColor: "rgba(61,104,255,0.5)",
                    borderColor:'#fff'
                },{
                   label: labels_f[1],
                   data: martes,
                   borderWidth: 0.5,
                    backgroundColor: "rgba(0,0,0,0.5)",
                   borderColor:'#fff'
                },{
                   label: labels_f[2],
                   data: miercoles,
                   borderWidth: 0.5,
                   backgroundColor: "rgba(61,104,255,0.5)",
                   borderColor:'#fff'
                },{
                   label: labels_f[3],
                   data: jueves,
                   borderWidth: 0.5,
                   backgroundColor: "rgba(0,0,0,0.5)",
                   borderColor:'#fff'
                },{
                    label: labels_f[4],
                    data: viernes,
                    borderWidth: 0.5,
                    backgroundColor: "rgba(0,0,0,0.5)",
                    borderColor:'#fff'
                },{
                    label: labels_f[5],
                    data: sabado,
                    borderWidth: 0.5,
                    backgroundColor: "rgba(0,0,0,0.5)",
                    borderColor:'#fff'
                },{
                    label: labels_f[6],
                    data: domingo,
                    borderWidth: 0.5,
                    backgroundColor: "rgba(0,0,0,0.5)",
                    borderColor:'#fff'
                }]
            },
            options: {
                responsive: true,

                scales: {
                    y: {
                        ticks: { color: 'black', beginAtZero: true }
                    },
                    x: {
                        ticks: { color: 'black', beginAtZero: true }
                    }
                },
                plugins: {


                    legend: {
                        labels: {
                            color: 'black',
                            title: {
                                display: true,
                                text: 'Número de accidentes por zona',
                                padding: {
                                    top: 100,
                                    bottom: 30
                                }
                            },
                            font: {
                                size: 20,
                                weight: '1000'
                            }
                        }
                    },


                }
            }
        });
    }
    </script>
    <!--Grafica de Genero -->
    <script>
      async function getQuery8(){
          let chartStatus = Chart.getChart("myChart8");
          if (chartStatus != undefined) {
              chartStatus.destroy();
          }

          let response = await fetch(`/query8/`, {mode: 'cors'});

          const ctx = document.getElementById('myChart8');

          let json = await response.json()

          let labels =  json.x
          let values =  json.y

          new Chart(ctx, {
              type: 'doughnut',
              data: {
                  labels: labels,
                  datasets: [{
                      label: `Número  `,
                      data: values,
                      borderWidth: 2,
                      backgroundColor: ["rgba(61,104,255,0.5 )","rgba(18,31,76,0.5 )"],
                      borderColor:"#fff"
                  }]
              },
              options: {
                  responsive: true,

                  scales: {
                      y: {
                          ticks: { color: 'black', beginAtZero: true }
                      },
                      x: {
                          ticks: { color: 'black', beginAtZero: true }
                      }
                  },
                  plugins: {

                      legend: {
                          labels: {
                              color: 'black',
                              title: {
                                  display: true,
                                  text: 'Número de accidentes por zona',
                              },
                              font: {
                                  size: 20,
                                  weight: '100'
                              }
                          }
                      },


                  }
              }
          });

      }
    </script>
    <!--Tabla de Tipo de Accidente -->
    <script>
       async function buildTable(){
           let table = document.getElementById('mytable')
           let response = await fetch(`/query6/`, {mode: 'cors'});
           let json = await response.json();
           let labels =  json.x;
           let values =  json.y;
           for(let i = 0; i<values.length;i++){
               let row = `<tr>
                              <td>${labels[i]}</td>
                              <td>${values[i]}</td>
                          </tr>`
               table.innerHTML += row
           }
       }
    </script>


</head>

<body class="bg-gray-100 font-family-karla flex" x-data="{anio: 2018, anio2: 2019 }" >

<aside class="relative bg-sidebar h-screen w-64 hidden sm:block shadow-xl">
  <div class="p-6">
    <a class="text-white text-3xl font-semibold uppercase hover:text-gray-300">Accidentes</a>
    <img href="https://upload.wikimedia.org/wikipedia/commons/8/89/INEGI.png">
  </div>
  <nav class="text-white text-base font-semibold pt-3">
    <a  class="flex items-center active-nav-link text-white py-4 pl-6 nav-item">
      <i class="fas fa-map mr-3"></i>
      México
    </a>
    <a  class="flex items-center text-white opacity-75 hover:opacity-100 py-4 pl-6 nav-item">
      <i class="fas fa-calendar mr-3"></i>
      Año
    </a>
    <a class="flex items-center text-white opacity-75 hover:opacity-100 py-4 pl-6 nav-item">
      <i class="fas fa-street-view mr-3"></i>
      Local
    </a>
  </nav>

</aside>

<div class="w-full flex flex-col h-screen overflow-y-hidden">
  <!-- Desktop Header -->
  <header class="w-full items-center bg-white py-2 px-6 hidden sm:flex">
    <div class="w-1/2"></div>
    <div x-data="{ isOpen: false }" class="relative w-1/2 flex justify-end">
      <button @click="isOpen = !isOpen" class="realtive z-10 w-12 h-12 rounded-full overflow-hidden border-4 border-gray-400 hover:border-gray-300 focus:border-gray-300 focus:outline-none">
        <img src="https://thumbs.dreamstime.com/b/car-accident-icon-logo-isolated-sign-symbol-vector-illustration-car-accident-icon-logo-isolated-sign-symbol-vector-198180016.jpg/300x300">
      </button>
      <button x-show="isOpen" @click="isOpen = false" class="h-full w-full fixed inset-0 cursor-default"></button>
      <div x-show="isOpen" class="absolute w-32 bg-white rounded-lg shadow-lg py-2 mt-16">
        <a href="https://www.inegi.org.mx/app/tabulados/interactivos/?px=ATUS_1&bd=ATUS&idrt=168&opc=t" class="block px-4 py-2 account-link hover:text-white">INEGI</a>
      </div>
    </div>
  </header>
<!--Inicio de el Display de la pagina Web -->
    <div class="w-full overflow-x-hidden border-t flex flex-col">
    <main class="w-full flex-grow p-6">
      <h1 id="Zona_Mexico"class="text-3xl text-black pb-6">AMDL - Accidentes Mexico</h1>

     <div class="flex flex-wrap mt-6">
        <div class="w-full lg:w-1/2 pr-0 lg:pr-2">
          <p class="text-xl pb-3 flex items-center">
            <i class="fas fa-compass mr-3"></i> Zonas de Impacto
          </p>
          <div class="p-6 bg-white">
            <canvas id="myChart4" width="400" height="200"></canvas>
          </div>
        </div>
        <div class="w-full lg:w-1/2 pl-0 lg:pl-2 mt-12 lg:mt-0">
          <p class="text-xl pb-3 flex items-center">
            <i class="fas fa-exclamation-circle mr-3"></i> Tipos de choque
          </p>
          <div class="p-6 bg-white">
            <canvas id="myChart5" width="400" height="200"></canvas>
          </div>
        </div>
      </div>



        <div>
          <p class="text-xl pb-3 flex items-center">
            <i class="fas fa-exclamation-circle mr-3"></i> Accidentes en la Repu
          </p>
          <div class="p-6 bg-white">
                <canvas id="myChart"></canvas>
          </div>
        </div>




     <div>
        <label>Elige un año para la tabla: </label>
        <select x-model="anio" >
            <template x-for="anio in ['2018', '2019', '2020', '2021']">
                <option x-text= "anio"></option>
            </template>
        </select>
        <button @click="await getQuery(anio)" >Enviar</button>
    </div>


    <div class="p-6 bg-white">
        <canvas id="myChart2"></canvas>
    </div>


     <div>
        <label>Elige un año para la tabla: </label>
        <select x-model="anio2" >
            <template x-for="anio2 in ['2018', '2019', '2020', '2021']">
                <option x-text= "anio2"></option>
            </template>
        </select>
        <button @click="await getQuery2(anio2)" >Enviar</button>
    </div>


    <div class="p-6 bg-white">
        <canvas id="myChart6"></canvas>
    </div>
    <div class="p-6 bg-white">
        <canvas id="myChart7"></canvas>
    </div>

    <div class="p-6 bg-white">
        <canvas id="myChart8"></canvas>
    </div>
    <div class="p-6 bg-white">
        <table class="table table-stripped">
            <tr class="bg-primary">
                <th>Tipo_de_Accidente</th>
                <th>Numero_de_Accidentes</th>
            </tr>
            <tbody id="mytable">
                <script>buildTable()</script>
            </tbody>
        </table>
    </div>


   </main>
  </div>
</div>






<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.1/dist/cdn.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


</body>
<script>getQuery(2018)</script>
<script>getQuery2(2018)</script>


<script>getQuery4()</script>
<script>getQuery5()</script>


<script>getQuery6()</script>
<script>getQuery7()</script>
<script>getQuery8()</script>

</html>
